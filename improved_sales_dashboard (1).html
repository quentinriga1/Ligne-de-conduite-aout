<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ligne de conduite - Dashboard Vendeur</title>
  <style>
    :root{
      --bg: #0f172a;
      --bg-secondary: #1e293b;
      --card: #334155;
      --card-light: #475569;
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --success: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --glass: rgba(51, 65, 85, 0.8);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    * { box-sizing: border-box; }
    
    body {
      background: linear-gradient(135deg, var(--bg) 0%, var(--bg-secondary) 100%);
      margin: 0;
      padding: 12px;
      color: var(--text);
      min-height: 100vh;
      font-size: 13px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 0;
      border-bottom: 1px solid var(--card);
    }
    
    h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: var(--text);
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }
    
    .btn.secondary {
      background: var(--card-light);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .btn.secondary:hover {
      background: var(--card);
    }
    
    .btn.admin {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      padding: 0;
      font-size: 24px;
      z-index: 1000;
      background: var(--accent);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
    }
    
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 12px;
    }
    
    .section-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .section-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid var(--card-light);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text);
      font-size: 12px;
      transition: all 0.2s ease;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }
    
    label {
      display: block;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .progress-item {
      margin-bottom: 12px;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--card-light);
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .progress-title {
      font-weight: 600;
      color: var(--text);
      font-size: 13px;
    }
    
    .progress-values {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--card);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 6px;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: all 0.3s ease;
      background: linear-gradient(90deg, var(--success), #34d399);
    }
    
    .progress-fill.warn {
      background: linear-gradient(90deg, var(--warn), #fbbf24);
    }
    
    .progress-fill.danger {
      background: linear-gradient(90deg, var(--danger), #f87171);
    }
    
    .input-group {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 12px;
      align-items: end;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 16px 0;
    }
    
    .stat-card {
      background: var(--bg-secondary);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid var(--card-light);
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--accent);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .admin-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(4px);
      z-index: 2000;
      overflow-y: auto;
    }
    
    .admin-content {
      max-width: 600px;
      margin: 40px auto;
      background: var(--card);
      border-radius: 16px;
      padding: 32px;
      position: relative;
    }
    
    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .close-btn:hover {
      color: var(--text);
      background: var(--card-light);
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .msg {
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .msg.success {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid var(--success);
      color: #6ee7b7;
    }
    
    .msg.error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid var(--danger);
      color: #fca5a5;
    }
    
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .controls {
        justify-content: center;
      }
      
      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üéØ Dashboard Vendeur</h1>
    <div class="controls">
      <label>
        Trimestre
        <select id="quarterSelect"></select>
      </label>
      <label>
        Vendeur
        <input id="sellerName" placeholder="Nom du vendeur" />
      </label>
      <button class="btn" id="loadBtn">Charger</button>
      <button class="btn secondary" id="exportBtn">Exporter</button>
    </div>
  </div>

  <div class="card">
    <div class="section-title">üìä Objectifs et R√©sultats</div>
    <div id="progressContainer"></div>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value" id="totalPoints">0</div>
      <div class="stat-label">Total Points</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="daysRemaining">0</div>
      <div class="stat-label">Jours Restants</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="dailyTarget">0</div>
      <div class="stat-label">Target Quotidien</div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">üíª Calculateurs</div>
    <div class="grid-2">
      <div>
        <h4>Stimulation</h4>
        <div style="margin-bottom: 8px;">
          <label>Moves</label>
          <input type="number" id="calc_moves" value="0" />
        </div>
        <div style="margin-bottom: 8px;">
          <label>Smartphone start / DIG edu</label>
          <input type="number" id="calc_move2" value="0" />
        </div>
        <div style="margin-bottom: 8px;">
          <label>Digital edu</label>
          <input type="number" id="calc_dig" value="0" />
        </div>
        <div style="margin-bottom: 8px;">
          <label>TV option / autres</label>
          <input type="number" id="calc_tvopt" value="0" />
        </div>
        <button class="btn" id="applyStim">Appliquer Stimulation</button>
      </div>
      <div>
        <h4>R√©tention</h4>
        <div style="margin-bottom: 8px;">
          <label>Proximus+</label>
          <input type="number" id="ret_prox" value="0" />
        </div>
        <div style="margin-bottom: 8px;">
          <label>Pickx</label>
          <input type="number" id="ret_pickx" value="0" />
        </div>
        <div style="margin-bottom: 8px;">
          <label>Scarlet</label>
          <input type="number" id="ret_scar" value="0" />
        </div>
        <button class="btn" id="applyRet">Appliquer R√©tention</button>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">üìù Notes</div>
    <textarea id="notes" placeholder="Vos notes et commentaires..." style="height: 60px;"></textarea>
    <button class="btn" id="saveBtn" style="margin-top: 12px;">Sauvegarder</button>
  </div>

  <button class="btn admin" id="adminBtn" title="Administration">‚öôÔ∏è</button>

  <!-- Admin Panel -->
  <div class="admin-panel" id="adminPanel">
    <div class="admin-content">
      <button class="close-btn" id="closeAdmin">√ó</button>
      <div class="section-title">‚öôÔ∏è Administration - D√©finir les Targets</div>
      
      <div id="adminTargets"></div>
      
      <div style="display: flex; gap: 16px; margin-top: 24px;">
        <button class="btn" id="saveTargets">Sauvegarder Targets</button>
        <button class="btn secondary" id="loadDefault">Charger par d√©faut</button>
        <button class="btn secondary" id="importBtn">Importer JSON</button>
      </div>
      <input type="file" id="fileInput" accept="application/json" style="display: none;" />
      <div id="adminMsg"></div>
    </div>
  </div>

  <div id="messages"></div>

  <script>
    const CATEGORIES = [
      {key:'internet', label:'Internet', icon:'üåê'},
      {key:'tv', label:'TV', icon:'üì∫'},
      {key:'voice', label:'Voice', icon:'üìû'},
      {key:'postpaid', label:'Postpaid & Full control', icon:'üì±'},
      {key:'accessoires', label:'Accessoires', icon:'üéß'},
      {key:'stimulation', label:'Stimulation', icon:'‚ö°'},
      {key:'retention', label:'R√©tention', icon:'üõ°Ô∏è'},
      {key:'vol_fiber', label:'Volume Fiber migration', icon:'üî•'},
      {key:'vol_scarlet', label:'Volume Scarlet', icon:'üî¥'},
      {key:'total_points', label:'Total Points', icon:'üéØ'}
    ];

    const DEFAULT_TARGETS = {
      internet: 475, tv: 227, voice: 55, postpaid: 922, accessoires: 891,
      stimulation: 180, retention: 451, vol_fiber: 23, vol_scarlet: 7, total_points: 3774
    };

    const QUARTERS = ['Q1-2025', 'Q2-2025', 'Q3-2025', 'Q4-2025', 'Q1-2026'];

    const $ = id => document.getElementById(id);

    function showMessage(text, type = 'success') {
      const msg = document.createElement('div');
      msg.className = `msg ${type}`;
      msg.textContent = text;
      $('messages').appendChild(msg);
      setTimeout(() => msg.remove(), 3000);
    }

    function saveTargets(quarter, data) {
      localStorage.setItem(`ldc_targets_${quarter}`, JSON.stringify(data));
    }

    function loadTargets(quarter) {
      const data = localStorage.getItem(`ldc_targets_${quarter}`);
      return data ? JSON.parse(data) : DEFAULT_TARGETS;
    }

    function saveResults(quarter, seller, data) {
      localStorage.setItem(`ldc_results_${quarter}_${seller}`, JSON.stringify(data));
    }

    function loadResults(quarter, seller) {
      const data = localStorage.getItem(`ldc_results_${quarter}_${seller}`);
      return data ? JSON.parse(data) : {};
    }

    function calculateProgress(result, target) {
      if (target === 0) return 0;
      return Math.min((result / target) * 100, 100);
    }

    function getProgressClass(progress) {
      if (progress >= 100) return '';
      if (progress >= 80) return 'warn';
      return 'danger';
    }

    function daysUntilQuarterEnd(quarter) {
      const [q, year] = quarter.split('-');
      const endDates = {
        'Q1': new Date(year, 2, 31),
        'Q2': new Date(year, 5, 30),
        'Q3': new Date(year, 8, 30),
        'Q4': new Date(year, 11, 31)
      };
      const end = endDates[q] || new Date();
      const diff = Math.ceil((end - new Date()) / (1000 * 60 * 60 * 24));
      return Math.max(0, diff);
    }

    function renderProgress() {
      const quarter = $('quarterSelect').value;
      const seller = $('sellerName').value.trim() || 'unknown';
      const targets = loadTargets(quarter);
      const results = loadResults(quarter, seller);
      
      const container = $('progressContainer');
      container.innerHTML = '';
      
      let totalTarget = 0;
      let totalResult = 0;
      
      CATEGORIES.forEach(cat => {
        const target = Number(targets[cat.key] || 0);
        const result = Number(results[cat.key] || 0);
        const progress = calculateProgress(result, target);
        
        if (cat.key !== 'total_points') {
          totalTarget += target;
          totalResult += result;
        }
        
        const item = document.createElement('div');
        item.className = 'progress-item';
        item.innerHTML = `
          <div class="progress-header">
            <div class="progress-title">${cat.icon} ${cat.label}</div>
            <div class="progress-values">${result} / ${target}</div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill ${getProgressClass(progress)}" style="width: ${progress}%"></div>
          </div>
          <div class="input-group">
            <input type="number" id="result_${cat.key}" value="${result}" placeholder="R√©sultat" step="0.1" />
            <div style="font-size: 12px; color: var(--text-muted); padding: 6px 0;">${Math.round(progress)}%</div>
          </div>
        `;
        container.appendChild(item);
      });
      
      // Update stats
      const days = daysUntilQuarterEnd(quarter);
      const totalPoints = results.total_points || 0;
      const totalTargetPoints = targets.total_points || 0;
      const dailyTarget = days > 0 ? Math.round((totalTargetPoints - totalPoints) / days * 10) / 10 : 0;
      const completionRate = totalTargetPoints > 0 ? Math.round((totalPoints / totalTargetPoints) * 100) : 0;
      
      $('totalPoints').textContent = totalPoints;
      $('daysRemaining').textContent = days;
      $('dailyTarget').textContent = dailyTarget;
      
      $('notes').value = results.notes || '';
    }

    function renderAdminTargets() {
      const quarter = $('quarterSelect').value;
      const targets = loadTargets(quarter);
      const container = $('adminTargets');
      container.innerHTML = '';
      
      CATEGORIES.forEach(cat => {
        const div = document.createElement('div');
        div.style.marginBottom = '16px';
        div.innerHTML = `
          <label>${cat.icon} ${cat.label}</label>
          <input type="number" id="admin_${cat.key}" value="${targets[cat.key] || 0}" step="0.1" />
        `;
        container.appendChild(div);
      });
    }

    function saveCurrentResults() {
      const quarter = $('quarterSelect').value;
      const seller = $('sellerName').value.trim() || 'unknown';
      const results = {};
      
      CATEGORIES.forEach(cat => {
        const input = $(`result_${cat.key}`);
        results[cat.key] = Number(input ? input.value : 0);
      });
      
      results.notes = $('notes').value;
      saveResults(quarter, seller, results);
      showMessage('R√©sultats sauvegard√©s !');
      renderProgress();
    }

    function exportData() {
      const quarter = $('quarterSelect').value;
      const seller = $('sellerName').value.trim() || 'unknown';
      const date = new Date().toISOString().split('T')[0];
      
      const data = {
        vendeur: seller,
        trimestre: quarter,
        date_export: date,
        targets: loadTargets(quarter),
        results: loadResults(quarter, seller)
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${seller}_${date}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showMessage('Export termin√© !');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Populate quarters
      QUARTERS.forEach(q => {
        const option = document.createElement('option');
        option.value = q;
        option.textContent = q;
        $('quarterSelect').appendChild(option);
      });
      $('quarterSelect').value = QUARTERS[2];
      
      renderProgress();
      renderAdminTargets();
      
      // Event listeners
      $('loadBtn').addEventListener('click', renderProgress);
      $('saveBtn').addEventListener('click', saveCurrentResults);
      $('exportBtn').addEventListener('click', exportData);
      
      // Admin panel
      $('adminBtn').addEventListener('click', () => {
        $('adminPanel').style.display = 'block';
        renderAdminTargets();
      });
      
      $('closeAdmin').addEventListener('click', () => {
        $('adminPanel').style.display = 'none';
      });
      
      $('saveTargets').addEventListener('click', () => {
        const quarter = $('quarterSelect').value;
        const targets = {};
        
        CATEGORIES.forEach(cat => {
          const input = $(`admin_${cat.key}`);
          targets[cat.key] = Number(input ? input.value : 0);
        });
        
        saveTargets(quarter, targets);
        showMessage('Targets sauvegard√©s !');
        renderProgress();
      });
      
      $('loadDefault').addEventListener('click', () => {
        if (confirm('Charger les valeurs par d√©faut ?')) {
          CATEGORIES.forEach(cat => {
            const input = $(`admin_${cat.key}`);
            if (input) input.value = DEFAULT_TARGETS[cat.key] || 0;
          });
          showMessage('Valeurs par d√©faut charg√©es');
        }
      });
      
      // Calculators
      $('applyStim').addEventListener('click', () => {
        const sum = ['calc_moves', 'calc_move2', 'calc_dig', 'calc_tvopt']
          .reduce((acc, id) => acc + Number($(id).value || 0), 0);
        const input = $('result_stimulation');
        if (input) {
          input.value = Math.round(sum * 10) / 10;
          showMessage('Stimulation appliqu√©e !');
          saveCurrentResults();
        }
      });
      
      $('applyRet').addEventListener('click', () => {
        const sum = ['ret_prox', 'ret_pickx', 'ret_scar']
          .reduce((acc, id) => acc + Number($(id).value || 0), 0);
        const input = $('result_retention');
        if (input) {
          input.value = Math.round(sum * 10) / 10;
          showMessage('R√©tention appliqu√©e !');
          saveCurrentResults();
        }
      });
      
      // Auto-save on input change
      document.addEventListener('input', (e) => {
        if (e.target.id && e.target.id.startsWith('result_')) {
          setTimeout(saveCurrentResults, 500);
        }
        if (e.target.id === 'sellerName') {
          setTimeout(renderProgress, 300);
        }
      });
      
      $('quarterSelect').addEventListener('change', () => {
        renderProgress();
        renderAdminTargets();
      });
      
      // Import functionality
      $('importBtn').addEventListener('click', () => $('fileInput').click());
      $('fileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            if (data.targets) {
              saveTargets($('quarterSelect').value, data.targets);
              renderAdminTargets();
              renderProgress();
              showMessage('Import r√©ussi !');
            }
          } catch (err) {
            showMessage('Erreur d\'import: ' + err.message, 'error');
          }
        };
        reader.readAsText(file);
      });
    });
  </script>
</body>
</html>